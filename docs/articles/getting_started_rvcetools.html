<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with rvcetools • rvcetools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with rvcetools">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rvcetools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started_rvcetools.html">Getting Started with rvcetools</a>
    </li>
    <li>
      <a href="../articles/plots_vce.html">Plot results of VCE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pvrqualitasag/rvcetools">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting Started with rvcetools</h1>
                        <h4 class="author">Peter von Rohr</h4>
            
            <h4 class="date">2019-10-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pvrqualitasag/rvcetools/blob/master/vignettes/getting_started_rvcetools.Rmd"><code>vignettes/getting_started_rvcetools.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started_rvcetools.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rvcetools)</a></code></pre></div>
<div id="disclaimer" class="section level2">
<h2 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h2>
<p>The package <code>rvcetools</code> is used to post-process and to work with results from programs that do variance components estimation (VCE). Initially, we limit our focus for result files from the program called <code>vce</code>.</p>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>Variance component estimation is the process of estimating scale parameters such as variance components from data. The parameter estimation uses linear mixed models to define the set of different random effects to which the observed variation should be attributed to.</p>
<p>Linear mixed effects models recently have gained some popularity outside of the area of animal breeding. But still there are not standard software packages around that can estimate variance components for very large datasets. Therefore, specialized softare programs are used for this task. These programs do not provide any features outside of the parameter estimation functionality. As a consequence of that results from the specialised programs must be read into systems such as R to do bending, plotting or other post-processing tasks.</p>
</div>
<div id="features" class="section level2">
<h2 class="hasAnchor">
<a href="#features" class="anchor"></a>Features</h2>
<p>The most central feature is to read in raw outfiles from the different variance components estimation programs. In the most basic case there is only one output file from one analysis. In more advanced analyses, there might be output files from repeated analyses of different sample data sets.</p>
<p>The package <code>rvcetools</code> contains a number of features already and they will hopefully grow over time. For the purpose of a genetic evaluation the most important feature is to read estimated variance components and to produce an input file for the software program that does the prediction of breeding values. This function is called <code><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99()</a></code>. All it needs is an input file and an output file and all steps in between will be done automatically. The functions envolved in all the steps are shown in the dependency graph below.</p>
<p><img src="getting_started_rvcetools_files/figure-html/codedependsgraph-1.png" width="700"></p>
</div>
<div id="package-input" class="section level2">
<h2 class="hasAnchor">
<a href="#package-input" class="anchor"></a>Package Input</h2>
<p>Currently the package can read VCE results from .csv files which are in a pre-defined format. For testing an example input file is included in the package available.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">(s_input &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"VCE_results.csv"</span>, <span class="dt">package =</span> <span class="st">"rvcetools"</span>))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/RtmpeGrh2V/temp_libpathc50b6cd40209/rvcetools/extdata/VCE_results.csv"</span></a></code></pre></div>
<p>The input data can be read using the function</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">(tbl_vce &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_vce.html">read_vce</a></span>(<span class="dt">psInputFile =</span> s_input))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; # A tibble: 6,414 x 9</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;    type  traits random_effect estimate STD_ERR_estimate model_name</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;  1 ratio caa    residual       0.261   0.019575         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;  2 cova… cac+c… residual       0       ---              &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;  3 cova… cac+c… animal         0.0152  0.005221         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;  4 gene… cac+c… animal         0.252   0.085193         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  5 vari… cac    herdyear       0.0128  0.000740         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  6 cova… cac+c… herdyear       0.00092 0.001490         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  7 heri… caa    animal         0.319   0.026249         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  8 ratio caa    herdyear       0.420   0.015139         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  9 vari… cac    residual       0.0271  0.001140         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 10 heri… cac    animal         0.231   0.026163         &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; # … with 6,404 more rows, and 3 more variables: data_subset_number &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; #   used_seed &lt;chr&gt;, trait_combination &lt;chr&gt;</span></a></code></pre></div>
</div>
<div id="conversion-of-correlation-to-covariance" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion-of-correlation-to-covariance" class="anchor"></a>Conversion of Correlation to Covariance</h2>
<p>When it comes to processing outputs of variance components estimation, it is useful to transform variance-covariance matrices into correlation matrices and the other way around. In most practical calses the matrices are small and hence a solution via iterative loops should be ok. An example is shown here</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">(mat_vcov &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">104</span>,<span class="dv">75</span>,<span class="dv">18</span>,<span class="dv">75</span>,<span class="dv">56</span>,<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">12</span>,<span class="dv">7</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; [1,]  104   75   18</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; [2,]   75   56   12</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; [3,]   18   12    7</span></a></code></pre></div>
<p>In <code>base</code>-R there is the function <code>cov2cor</code> which does this.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cov2cor</a></span>(mat_vcov)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt;           [,1]      [,2]      [,3]</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; [1,] 1.0000000 0.9827670 0.6671244</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; [2,] 0.9827670 1.0000000 0.6060915</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [3,] 0.6671244 0.6060915 1.0000000</span></a></code></pre></div>
<p>The package contains a wrapper that does the same thing</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">(mat_cor &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cov_to_cor.html">cov_to_cor</a></span>(mat_vcov))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt;           [,1]      [,2]      [,3]</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1,] 1.0000000 0.9827670 0.6671244</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; [2,] 0.9827670 1.0000000 0.6060915</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [3,] 0.6671244 0.6060915 1.0000000</span></a></code></pre></div>
<p>In rare cases there might also be the interest of going the other way round. Hence given a correlation matrix and a vector of variances, we might be interested in re-building the original variance-covariance matrix. This is done with</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/cor_to_cov.html">cor_to_cov</a></span>(<span class="dt">pmat_cor =</span> mat_cor, <span class="dt">pvec_var =</span> <span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(mat_vcov))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; [1,]  104   75   18</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [2,]   75   56   12</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; [3,]   18   12    7</span></a></code></pre></div>
</div>
<div id="bending" class="section level2">
<h2 class="hasAnchor">
<a href="#bending" class="anchor"></a>Bending</h2>
<p>When building variance-covariance matrices from parameter estimation results, one problem might be that the resulting matrix is not positive definite. One solution to that problem might be a technique called bending. There are different approaches how bending can be implemented. An first intuitive approach is to decrease all off-diagonal elements by a small amount and to increase the diagonal elements also by some small quantity. This is done iteratively until the smallest eigenvalue of the resulting variance-covariance matrix is larger than some specified lower limit.</p>
<p>Alternatively, the eigenvalues below a certain threshold can be projected above that threshold leaving the ratios of the distances between the eigenvalues constant. This is implemented in the function <code><a href="../reference/makePD2.html">makePD2()</a></code>. Hence for a non-positive definite matrix containing estimation results, the following steps can be used to bend the matrix.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">(mat_npd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">100</span>, <span class="dv">80</span>, <span class="dv">20</span>, <span class="dv">6</span>, <span class="dv">80</span>, <span class="dv">50</span>, <span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; [1,]  100   80   20    6</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [2,]   80   50   10    2</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; [3,]   20   10    6    1</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [4,]    6    2    1    1</span></a></code></pre></div>
<p>Based on the eigenvalues <code>mat_npd</code> is non-positive definite</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span>(mat_npd, <span class="dt">only.values =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; [1] 162.1627196   4.1339019   0.9171925 -10.2138140</span></a></code></pre></div>
<p>The matrix <code>mat_npd</code> can be bent using</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">(mat_bent1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/makePD2.html">makePD2</a></span>(<span class="dt">A =</span> mat_npd))</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;            [,1]      [,2]      [,3]     [,4]</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1,] 103.615081 75.499246 18.377481 5.013141</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; [2,]  75.499246 55.603411 12.020026 3.228634</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; [3,]  18.377481 12.020026  6.728218 1.442922</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; [4,]   5.013141  3.228634  1.442922 1.269397</span></a></code></pre></div>
<p>As can be seen, the eigenvalues of the bent matrix are all positive, but the ratio between the smallest and the largest eigenvalue is big.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span>(mat_bent1, <span class="dt">only.values =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; [1] 1.621627e+02 4.133902e+00 9.171925e-01 2.292926e-03</span></a></code></pre></div>
<p>If this ratio is of any concern, the second bending function <code><a href="../reference/make_pd_rat_ev.html">make_pd_rat_ev()</a></code> can be used which allows for the specification of a maximum ratio between smallest and largest eigenvalue.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">(mat_bent2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_pd_rat_ev.html">make_pd_rat_ev</a></span>(<span class="dt">A =</span> mat_npd, <span class="dt">pn_max_ratio =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt;            [,1]      [,2]       [,3]      [,4]</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; [1,] 104.195930 74.774864 18.0837820 4.9954987</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; [2,]  74.774864 56.506986 12.3914112 3.2288164</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; [3,]  18.083782 12.391411  7.0139582 0.8658603</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; [4,]   4.995499  3.228816  0.8658603 3.7720338</span></a></code></pre></div>
<p>Leading to a much smaller range of eigenvalues as can be seen from the output below.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span>(mat_bent2, <span class="dt">only.values =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; [1] 162.162720   4.133902   3.570658   1.621627</span></a></code></pre></div>
<div id="alternatives" class="section level3">
<h3 class="hasAnchor">
<a href="#alternatives" class="anchor"></a>Alternatives</h3>
<p>The <code>Matrix</code> package contains the function <code>nearPD</code> which according to its helpfile computes the nearest positive definite matrix. This function allows the specification of many more parameters. But from our experiences this can lead to the large change in a single matrix element. Furthermore, it is unclear whether it is possible to change more than one eigenvalue.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">Matrix<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/Matrix/man/nearPD.html">nearPD</a></span>(mat_npd)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">#&gt; $mat</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt; 4 x 4 Matrix of class "dpoMatrix"</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt;            [,1]      [,2]      [,3]     [,4]</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; [1,] 103.614269 75.500255 18.377845 5.013362</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; [2,]  75.500255 55.602154 12.019573 3.228358</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; [3,]  18.377845 12.019573  6.728055 1.442822</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt; [4,]   5.013362  3.228358  1.442822 1.269336</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; $eigenvalues</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; [1] 1.621627e+02 4.133902e+00 9.171925e-01 1.621627e-06</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; $corr</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt; $normF</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; [1] 10.21382</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; $iterations</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt; $rel.tol</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt; $converged</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="co">#&gt; attr(,"class")</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29"><span class="co">#&gt; [1] "nearPD"</span></a></code></pre></div>
</div>
</div>
<div id="input-for-mix99" class="section level2">
<h2 class="hasAnchor">
<a href="#input-for-mix99" class="anchor"></a>Input For MiX99</h2>
<p>In livestock breeding, variance components are required as input to predict breeding values. The software package MiX99 is used to predict breeding values. In this package <code>rvcetools</code>, the function <code><a href="../reference/create_parameter_varCovar_mix99.html">create_parameter_varCovar_mix99()</a></code> creates output that can be used as input for MiX99. The function <code><a href="../reference/create_parameter_varCovar_mix99.html">create_parameter_varCovar_mix99()</a></code> writes the post-processed variance components output in a tabular form to a file. The format of this output can be shown below.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">sInputFile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"VCE_results.csv"</span>, <span class="dt">package =</span> <span class="st">"rvcetools"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">ResultPD &lt;-<span class="st"> </span><span class="kw"><a href="../reference/positivedefinit.html">positivedefinit</a></span>(<span class="dt">psInputFile =</span> sInputFile, <span class="dt">pnDigits =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1671 rows</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt; [3, 5, 6, 7, 8, 9, 10, 11, 13, 15, 16, 18, 20, 21, 22, 23, 24, 26, 29,</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; 31, ...].</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">sMix99File &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">'mix99_output.txt'</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw"><a href="../reference/create_parameter_varCovar_mix99.html">create_parameter_varCovar_mix99</a></span>(<span class="dt">pl_mat       =</span> ResultPD,</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">                                <span class="dt">psOutputFile =</span> sMix99File)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">vec_result &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="dt">con =</span> <span class="kw"><a href="https://rdrr.io/r/base/connections.html">file</a></span>(sMix99File))</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span>(sMix99File)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(vec_result)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; [1] "herdyear caa caa 0.412"  "herdyear caa cac 0.003" </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt; [3] "herdyear caa cca 0.007"  "herdyear caa ccc 0.011" </span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; [5] "herdyear caa cfa -0.015" "herdyear caa cfc 0.003"</span></a></code></pre></div>
<p>What is shown in the above code-junk can be done in one step using the function <code><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99()</a></code> with an input and an output file as parameter as shown below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">sInputFile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"VCE_results.csv"</span>, <span class="dt">package =</span> <span class="st">"rvcetools"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">sMix99File &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">'mix99_output.txt'</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw"><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99</a></span>(<span class="dt">psInputFile =</span> sInputFile, <span class="dt">psOutputFile =</span> sMix99File, <span class="dt">pnDigits =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1671 rows</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; [3, 5, 6, 7, 8, 9, 10, 11, 13, 15, 16, 18, 20, 21, 22, 23, 24, 26, 29,</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; 31, ...].</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">vec_result &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="dt">con =</span> <span class="kw"><a href="https://rdrr.io/r/base/connections.html">file</a></span>(sMix99File))</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span>(sMix99File)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(vec_result)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; [1] "herdyear caa caa 0.412"  "herdyear caa cac 0.003" </span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; [3] "herdyear caa cca 0.007"  "herdyear caa ccc 0.011" </span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; [5] "herdyear caa cfa -0.015" "herdyear caa cfc 0.003"</span></a></code></pre></div>
<p>Using the bending approach that changes the ratios of the eigenvalues is shown below</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sInputFile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"VCE_results.csv"</span>, <span class="dt">package =</span> <span class="st">"rvcetools"</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">sMix99File &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">'mix99_output.txt'</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw"><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99</a></span>(<span class="dt">psInputFile =</span> sInputFile, <span class="dt">psOutputFile =</span> sMix99File, <span class="dt">psOptionRatio =</span> <span class="ot">TRUE</span>, <span class="dt">psRatio =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1671 rows</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt; [3, 5, 6, 7, 8, 9, 10, 11, 13, 15, 16, 18, 20, 21, 22, 23, 24, 26, 29,</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt; 31, ...].</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7">vec_result &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="dt">con =</span> <span class="kw"><a href="https://rdrr.io/r/base/connections.html">file</a></span>(sMix99File))</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span>(sMix99File)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(vec_result)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; [1] "herdyear caa caa 0.4119715"   "herdyear caa cac 0.002703273"</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; [3] "herdyear caa cca 0.007328"    "herdyear caa ccc 0.01073419" </span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; [5] "herdyear caa cfa -0.01525923" "herdyear caa cfc 0.003302973"</span></a></code></pre></div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; R version 3.6.1 (2019-07-05)</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt; Running under: macOS Mojave 10.14.6</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; Matrix products: default</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; locale:</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; attached base packages:</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; [1] grid      parallel  stats     graphics  grDevices utils     datasets </span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; [8] methods   base     </span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt; other attached packages:</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; [1] Rgraphviz_2.28.0    graph_1.62.0        BiocGenerics_0.30.0</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt; [4] CodeDepends_0.6.5   rvcetools_0.0.4    </span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">#&gt; loaded via a namespace (and not attached):</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt;  [1] Rcpp_1.0.2       compiler_3.6.1   pillar_1.4.2     tools_3.6.1     </span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt;  [5] zeallot_0.1.0    digest_0.6.21    lattice_0.20-38  lifecycle_0.1.0 </span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">#&gt;  [9] evaluate_0.14    memoise_1.1.0    tibble_2.1.3     gtable_0.3.0    </span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="co">#&gt; [13] pkgconfig_2.0.3  rlang_0.4.0      Matrix_1.2-17    cli_1.1.0       </span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="co">#&gt; [17] rstudioapi_0.10  yaml_2.2.0       pkgdown_1.4.1    xfun_0.10       </span></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="co">#&gt; [21] stringr_1.4.0    dplyr_0.8.3      knitr_1.25       hms_0.5.1       </span></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="co">#&gt; [25] desc_1.2.0       fs_1.3.1         vctrs_0.2.0      stats4_3.6.1    </span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="co">#&gt; [29] rprojroot_1.3-2  tidyselect_0.2.5 glue_1.3.1       R6_2.4.0        </span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30"><span class="co">#&gt; [33] fansi_0.4.0      XML_3.98-1.20    rmarkdown_1.16   readr_1.3.1     </span></a>
<a class="sourceLine" id="cb18-31" data-line-number="31"><span class="co">#&gt; [37] ggplot2_3.2.1    purrr_0.3.2      tidyr_1.0.0      magrittr_1.5    </span></a>
<a class="sourceLine" id="cb18-32" data-line-number="32"><span class="co">#&gt; [41] ellipsis_0.3.0   codetools_0.2-16 backports_1.1.5  scales_1.0.0    </span></a>
<a class="sourceLine" id="cb18-33" data-line-number="33"><span class="co">#&gt; [45] htmltools_0.4.0  MASS_7.3-51.4    assertthat_0.2.1 colorspace_1.4-1</span></a>
<a class="sourceLine" id="cb18-34" data-line-number="34"><span class="co">#&gt; [49] utf8_1.1.4       stringi_1.4.3    lazyeval_0.2.2   munsell_0.5.0   </span></a>
<a class="sourceLine" id="cb18-35" data-line-number="35"><span class="co">#&gt; [53] crayon_1.3.4</span></a></code></pre></div>
</div>
<div id="latest-update" class="section level1">
<h1 class="hasAnchor">
<a href="#latest-update" class="anchor"></a>Latest Update</h1>
<p>2019-10-07 15:57:16 (pvr)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#disclaimer">Disclaimer</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#features">Features</a></li>
      <li><a href="#package-input">Package Input</a></li>
      <li><a href="#conversion-of-correlation-to-covariance">Conversion of Correlation to Covariance</a></li>
      <li><a href="#bending">Bending</a></li>
      <li><a href="#input-for-mix99">Input For MiX99</a></li>
      <li><a href="#session-info">Session Info</a></li>
      <li><a href="#latest-update">Latest Update</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sophie Kunz, Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
