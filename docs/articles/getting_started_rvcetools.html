<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with rvcetools â€¢ rvcetools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with rvcetools">
<meta property="og:description" content="rvcetools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rvcetools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bending_methods.html">Bending Methods</a>
    </li>
    <li>
      <a href="../articles/getting_started_rvcetools.html">Getting Started with rvcetools</a>
    </li>
    <li>
      <a href="../articles/plots_vce.html">Plot results of VCE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pvrqualitasag/rvcetools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with rvcetools</h1>
                        <h4 class="author">Peter von Rohr</h4>
            
            <h4 class="date">2021-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pvrqualitasag/rvcetools/blob/master/vignettes/getting_started_rvcetools.Rmd"><code>vignettes/getting_started_rvcetools.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started_rvcetools.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rvcetools</span>)</pre></body></html></div>
<div id="disclaimer" class="section level2">
<h2 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h2>
<p>The package <code>rvcetools</code> is used to post-process and to work with results from programs that do variance components estimation (VCE). Initially, we limit our focus for result files from the program called <code>vce</code>.</p>
</div>
<div id="package-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#package-usage" class="anchor"></a>Package Usage</h2>
<p>One possible use case for this package is to produce an input parameter file for the prediction of breeding values. Because we are using <code>MiX99</code> to predict breeding values, the next subsection describes how to prepare a parameter input file for <code>MiX99</code>.</p>
<div id="input-for-mix99" class="section level3">
<h3 class="hasAnchor">
<a href="#input-for-mix99" class="anchor"></a>Input For MiX99</h3>
<p>A parameter input file for <code>MiX99</code> can be produced using the function <code><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99()</a></code>. The function requires at least an input file with the results from the variance components estimation and an output file in which the parameters for the prediction of the breeding values are stored. Based on that a minimal call looks as follows</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">sInputFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"VCE_results.csv"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"rvcetools"</span>)
<span class="no">sMix99File</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">'mix99_output.txt'</span>)
<span class="fu"><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99</a></span>(<span class="kw">ps_input_file</span> <span class="kw">=</span> <span class="no">sInputFile</span>, <span class="kw">ps_output_file</span> <span class="kw">=</span> <span class="no">sMix99File</span>)</pre></body></html></div>
<p>The above function call reads the variance-covariance matrices, checks whether they are positive definite or not. If they are not, the matrices are bent using the method described in the book by L. Schaeffer in chapter 7.4. The produced parameter file has the following structure.</p>
<pre><code>#&gt; [1] TRUE
#&gt; [1] "herdyear caa caa 0.4119715"   "herdyear caa cac 0.002703273"
#&gt; [3] "herdyear caa cca 0.007328"    "herdyear caa ccc 0.01073419" 
#&gt; [5] "herdyear caa cfa -0.01525923" "herdyear caa cfc 0.003302973"</code></pre>
<p>There are two more bending methods available in <code>rvcetools</code>.</p>
<ol style="list-style-type: decimal">
<li>bending based on an upper bound of the ratio of the largest to the smallest eigenvalue and</li>
<li>weighted and unweighted bending described in a paper by Jorjani et al. 2003</li>
</ol>
<p>These two methods can be chosen by changing the parameters of the call to <code><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99()</a></code>. The eigenvalue <strong>ratio</strong> based method is applied with the following function call</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99</a></span>(<span class="kw">ps_input_file</span> <span class="kw">=</span> <span class="no">sInputFile</span>, <span class="kw">ps_output_file</span> <span class="kw">=</span> <span class="no">sMix99File</span>, <span class="kw">pn_ratio</span> <span class="kw">=</span> <span class="fl">100</span>)</pre></body></html></div>
<p>The additional parameter <code>pn_ratio</code> specifies the maximal allowed ratio of the largest to the smallest eigenvalue. The structure of the output file is the same</p>
<pre><code>#&gt; [1] TRUE
#&gt; [1] "herdyear caa caa 0.4119715"   "herdyear caa cac 0.002703273"
#&gt; [3] "herdyear caa cca 0.007328"    "herdyear caa ccc 0.01073419" 
#&gt; [5] "herdyear caa cfa -0.01525923" "herdyear caa cfc 0.003302973"</code></pre>
<p><strong>Unweighted</strong> bending is used when specifying the parameter <code>pn_eps</code> which can be used to give a fixed value to the smallest eigenvalue of the resulting matrix.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99</a></span>(<span class="kw">ps_input_file</span> <span class="kw">=</span> <span class="no">sInputFile</span>, <span class="kw">ps_output_file</span> <span class="kw">=</span> <span class="no">sMix99File</span>, <span class="kw">pn_eps</span> <span class="kw">=</span> <span class="fl">1e-4</span>)</pre></body></html></div>
<pre><code>#&gt; [1] TRUE</code></pre>
<p>The weighted version of the method can be used when specifying a weight matrix using the function parameter <code>pmat_weight</code>. The specified weight matrix must have the same dimension as the variance-covariance matrices. The current version allows only to specify one weight matrix for all variance-covariance matrices of the different random effects.</p>
</div>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>Variance components estimation is the process of estimating scale parameters such as variance components from data. The parameter estimation uses linear mixed models to define the set of different random effects to which the observed variation should be attributed to.</p>
<p>Linear mixed effects models recently have gained some popularity outside of the area of animal breeding. But still there are not standard software packages around that can estimate variance components for very large datasets. Therefore, specialized softare programs are used for this task. These programs do not provide any features outside of the parameter estimation functionality. As a consequence of that results from the specialised programs must be read into systems such as R to do bending, plotting or other post-processing tasks.</p>
</div>
<div id="features" class="section level2">
<h2 class="hasAnchor">
<a href="#features" class="anchor"></a>Features</h2>
<p>The most central feature is to read in raw outfiles from the different variance components estimation programs. In the most basic case there is only one output file from one analysis. In more advanced analyses, there might be output files from repeated analyses of different sample data sets.</p>
<p>The package <code>rvcetools</code> contains a number of features already and they will hopefully grow over time. For the purpose of a genetic evaluation the most important feature is to read estimated variance components and to produce an input file for the software program that does the prediction of breeding values. This function is called <code><a href="../reference/parameter_varCovar_mix99.html">parameter_varCovar_mix99()</a></code>. All it needs is an input file and an output file and all steps in between will be done automatically. The functions envolved in all the steps are shown in the dependency graph below.</p>
<pre><code>#&gt; Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
#&gt; logical.return = TRUE, : es gibt kein Paket namens 'CodeDepends'</code></pre>
</div>
<div id="conversion-of-correlation-to-covariance" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion-of-correlation-to-covariance" class="anchor"></a>Conversion of Correlation to Covariance</h2>
<p>When it comes to processing outputs of variance components estimation, it is useful to transform variance-covariance matrices into correlation matrices and the other way around. In most practical calses the matrices are small and hence a solution via iterative loops should be ok. An example is shown here</p>
<div class="sourceCode"><html><body><pre class="r">(<span class="no">mat_vcov</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">104</span>,<span class="fl">75</span>,<span class="fl">18</span>,<span class="fl">75</span>,<span class="fl">56</span>,<span class="fl">12</span>,<span class="fl">18</span>,<span class="fl">12</span>,<span class="fl">7</span>), <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]  104   75   18</span>
<span class="co">#&gt; [2,]   75   56   12</span>
<span class="co">#&gt; [3,]   18   12    7</span></pre></body></html></div>
<p>In <code>base</code>-R there is the function <code>cov2cor</code> which does this.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov2cor</a></span>(<span class="no">mat_vcov</span>)
<span class="co">#&gt;           [,1]      [,2]      [,3]</span>
<span class="co">#&gt; [1,] 1.0000000 0.9827670 0.6671244</span>
<span class="co">#&gt; [2,] 0.9827670 1.0000000 0.6060915</span>
<span class="co">#&gt; [3,] 0.6671244 0.6060915 1.0000000</span></pre></body></html></div>
<p>The package contains a wrapper that does the same thing</p>
<div class="sourceCode"><html><body><pre class="r">(<span class="no">mat_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cov_to_cor.html">cov_to_cor</a></span>(<span class="no">mat_vcov</span>))
<span class="co">#&gt;           [,1]      [,2]      [,3]</span>
<span class="co">#&gt; [1,] 1.0000000 0.9827670 0.6671244</span>
<span class="co">#&gt; [2,] 0.9827670 1.0000000 0.6060915</span>
<span class="co">#&gt; [3,] 0.6671244 0.6060915 1.0000000</span></pre></body></html></div>
<p>In rare cases there might also be the interest of going the other way round. Hence given a correlation matrix and a vector of variances, we might be interested in re-building the original variance-covariance matrix. This is done with</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/cor_to_cov.html">cor_to_cov</a></span>(<span class="kw">pmat_cor</span> <span class="kw">=</span> <span class="no">mat_cor</span>, <span class="kw">pvec_var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">mat_vcov</span>))
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]  104   75   18</span>
<span class="co">#&gt; [2,]   75   56   12</span>
<span class="co">#&gt; [3,]   18   12    7</span></pre></body></html></div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()
<span class="co">#&gt; R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)</span>
<span class="co">#&gt; Running under: OS X El Capitan 10.11.6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] de_CH.UTF-8/de_CH.UTF-8/de_CH.UTF-8/C/de_CH.UTF-8/de_CH.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] rvcetools_0.0.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.4        compiler_3.6.3    pillar_1.4.4      tools_3.6.3      </span>
<span class="co">#&gt;  [5] digest_0.6.25     evaluate_0.14     memoise_1.1.0     lifecycle_0.2.0  </span>
<span class="co">#&gt;  [9] tibble_3.0.1      gtable_0.3.0      pkgconfig_2.0.3   rlang_0.4.10     </span>
<span class="co">#&gt; [13] rstudioapi_0.11   yaml_2.2.1        pkgdown_1.5.1     xfun_0.13        </span>
<span class="co">#&gt; [17] stringr_1.4.0     dplyr_0.8.5       knitr_1.28        hms_0.5.3        </span>
<span class="co">#&gt; [21] desc_1.2.0        fs_1.4.1          vctrs_0.3.1       rprojroot_1.3-2  </span>
<span class="co">#&gt; [25] grid_3.6.3        tidyselect_1.0.0  glue_1.4.1        R6_2.4.1         </span>
<span class="co">#&gt; [29] rmarkdown_2.3     ggplot2_3.3.1     purrr_0.3.4       tidyr_1.0.2      </span>
<span class="co">#&gt; [33] readr_1.3.1       magrittr_1.5      backports_1.1.8   scales_1.1.1     </span>
<span class="co">#&gt; [37] htmltools_0.5.1.1 ellipsis_0.3.1    MASS_7.3-51.6     assertthat_0.2.1 </span>
<span class="co">#&gt; [41] colorspace_1.4-1  stringi_1.4.6     munsell_0.5.0     crayon_1.3.4</span></pre></body></html></div>
</div>
<div id="latest-update" class="section level1">
<h1 class="hasAnchor">
<a href="#latest-update" class="anchor"></a>Latest Update</h1>
<p>2021-03-16 10:57:23 (skn)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sophie Kunz, Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
